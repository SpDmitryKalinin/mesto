(()=>{"use strict";function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var e=function(){function e(t,n,o,r,i,a,c,u){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),this._item=t,this._template=n,this._initPopUpPicture=o,this._countLike=r,this.openDeletePopUp=i,this._setLike=a,this._deleteLike=c,this._userId=u}var n,o;return n=e,(o=[{key:"returnCardElement",value:function(t){return this._initCard(t),this._cardElement}},{key:"_templateClone",value:function(){return this._template.cloneNode(!0)}},{key:"_templateCloneButton",value:function(){return this._templateDeleteButton.cloneNode(!0)}},{key:"_initCard",value:function(t){var e=this;this._cardElement=this._templateClone(),this._buttonCardLike=this._cardElement.querySelector(".element__button-like"),this._buttonCardDelete=this._cardElement.querySelector(".element__button-delete"),this._addDeleteButton(this._item.owner._id),this._image=this._cardElement.querySelector(".element__image"),this._cardElement.querySelector(".element__title").textContent=this._item.name,this._image.src=this._item.link,this._image.alt=this._item.name,this._counterLike=this._cardElement.querySelector(".element__counter-like"),this._counterLike.textContent=this._countLike,this._setEventListeners(this._image,this._buttonCardLike),this._item.likes.forEach((function(n){n.name===t&&e._buttonCardLike.classList.add("element__button-like_active")}))}},{key:"_addDeleteButton",value:function(t){this._cardElement.querySelector(".element").setAttribute("id","".concat(this._item._id)),t!="".concat(this._userId)&&this._buttonCardDelete.remove()}},{key:"_setEventListeners",value:function(t,e){var n=this;t.addEventListener("click",(function(){return n._initPopUpPicture(n._item)})),e.addEventListener("click",(function(t){return n._likeCardHandler(e,t.target.closest(".element").id)})),this._buttonCardDelete&&this._buttonCardDelete.addEventListener("click",(function(t){n.openDeletePopUp(t.target.closest(".element").id)}))}},{key:"_likeCardHandler",value:function(t,e){t.classList.contains("element__button-like_active")?this._deleteLike(e,t,this._counterLike):this._setLike(e,t,this._counterLike)}}])&&t(n.prototype,o),e}();function n(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var o=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._data=e,this._form=n,this._inputList=Array.from(n.querySelectorAll(this._data.inputSelector)),this._submitButton=this._form.querySelector(this._data.submitButtonSelector)}var e,o;return e=t,(o=[{key:"enableValidation",value:function(){this._setAddEventListeners(this._form)}},{key:"_setAddEventListeners",value:function(){var t=this;this._inputList.forEach((function(e){e.addEventListener("input",(function(n){t._validateInputs(n,e)}))})),this._form.addEventListener("submit",(function(t){t.preventDefault()}))}},{key:"_validateInputs",value:function(t,e){var n=e.closest("label").querySelector(".".concat(this._data.errorContainClass));t.target.validity.valid||(t.target.classList.add(this._data.inputErrorClass),n.classList.add(this._data.errorClass),n.textContent=t.target.validationMessage),t.target.validity.valid&&(t.target.classList.remove(this._data.inputErrorClass),n.classList.remove(this._data.errorClass),n.textContent="");var o=this._validateForm();this._activeOrDisabledSubmit(o)}},{key:"_validateForm",value:function(){return!this._inputList.some((function(t){return!t.validity.valid}))}},{key:"_activeOrDisabledSubmit",value:function(t){t?(this._submitButton.classList.remove(this._data.inactiveButtonClass),this._submitButton.removeAttribute("disabled")):(this._submitButton.classList.add(this._data.inactiveButtonClass),this._submitButton.setAttribute("disabled","disabled"))}}])&&n(e.prototype,o),t}();function r(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var i=function(){function t(e,n,o){var r=e.renderer;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._renderer=r,this.contain=n,this.userName=o}var e,n;return e=t,(n=[{key:"addArray",value:function(t,e,n){var o=this;t.forEach((function(t){o._renderer(t,e,n,o.contain)}))}},{key:"addItem",value:function(t,e){e.prepend(t)}}])&&r(e.prototype,n),t}(),a={formSelector:".modal-window__form",inputSelector:".modal-window__item",submitButtonSelector:".modal-window__submit-button",inactiveButtonClass:"modal-window__submit-button_disabled",inputErrorClass:"modal-window__item_error",errorClass:"modal-window__type-error_active",errorContainClass:"modal-window__type-error"},c=document.querySelector(".modal-window_edit"),u=document.querySelector(".modal-window_add"),s=document.querySelector(".modal-window_confirm"),l=document.querySelector(".modal-window_edit-avatar"),f=document.querySelector(".modal-window__submit-button-edit-avatar"),d=document.querySelector(".modal-window__submit-button-edit-info"),_=document.querySelector(".modal-window__submit-button-add-card"),h=document.querySelector(".profile__edit-button"),m=document.querySelector(".modal-window__place"),p=document.querySelector(".modal-window__link"),y=document.querySelector(".modal-window__form_edit"),v=document.querySelector(".modal-window__form_add"),b=document.querySelector(".modal-window__form_edit-avatar"),w=document.querySelector(".profile__add-button"),k=document.querySelector(".elements"),g=document.querySelector(".template-element").content,C=document.querySelector(".modal-window_image"),E=document.querySelector(".modal-window__name"),S=document.querySelector(".modal-window__employment"),L=document.querySelector(".modal-window__delete-button"),O=document.querySelector(".profile__avatar-edit-button");function P(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var q=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._popUpElement=e,this._escHandle=this._handleEscClose.bind(this)}var e,n;return e=t,(n=[{key:"open",value:function(){this._popUpElement.classList.add("modal-window_is-open"),document.addEventListener("keydown",this._escHandle)}},{key:"close",value:function(){this._popUpElement.classList.remove("modal-window_is-open"),document.removeEventListener("keydown",this._escHandle)}},{key:"_handleEscClose",value:function(t){if(27!==t.keyCode)return 0;this.close()}},{key:"setEventListeners",value:function(){var t=this;this._popUpElement.querySelector(".modal-window__close-button").addEventListener("click",(function(){return t.close()})),this._popUpElement.addEventListener("click",(function(e){e.target===t._popUpElement&&t.close()}))}}])&&P(e.prototype,n),t}();function j(t){return(j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function A(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function D(t,e,n){return(D="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var o=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=x(t)););return t}(t,e);if(o){var r=Object.getOwnPropertyDescriptor(o,e);return r.get?r.get.call(n):r.value}})(t,e,n||t)}function R(t,e){return(R=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function U(t,e){return!e||"object"!==j(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function x(t){return(x=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var I=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&R(t,e)}(a,t);var e,n,o,r,i=(o=a,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=x(o);if(r){var n=x(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return U(this,t)});function a(t,e){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(n=i.call(this,t,e)).popUpImg=n._popUpElement.querySelector(".modal-window__full-image"),n.popUpcaption=n._popUpElement.querySelector(".modal-window__image-caption"),n}return e=a,(n=[{key:"open",value:function(t){this.popUpcaption.textContent=t.name,this.popUpImg.src=t.link,this.popUpImg.alt=t.name,D(x(a.prototype),"open",this).call(this)}}])&&A(e.prototype,n),a}(q);function T(t){return(T="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function B(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function N(t,e,n){return(N="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var o=J(t,e);if(o){var r=Object.getOwnPropertyDescriptor(o,e);return r.get?r.get.call(n):r.value}})(t,e,n||t)}function z(t,e){return(z=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function H(t,e){return!e||"object"!==T(e)&&"function"!=typeof e?V(t):e}function V(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function F(t,e,n,o){return(F="undefined"!=typeof Reflect&&Reflect.set?Reflect.set:function(t,e,n,o){var r,i=J(t,e);if(i){if((r=Object.getOwnPropertyDescriptor(i,e)).set)return r.set.call(o,n),!0;if(!r.writable)return!1}if(r=Object.getOwnPropertyDescriptor(o,e)){if(!r.writable)return!1;r.value=n,Object.defineProperty(o,e,r)}else!function(t,e,n){e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n}(o,e,n);return!0})(t,e,n,o)}function J(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=G(t)););return t}function G(t){return(G=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var M=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&z(t,e)}(a,t);var e,n,o,r,i=(o=a,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=G(o);if(r){var n=G(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return H(this,t)});function a(t,e,n){var o,r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),function(t,e,n,o,r){if(!F(t,"submitButtonSelector",n,o||t))throw new Error("failed to set property")}((o=V(r=i.call(this,t)),G(a.prototype)),0,e,o),r.handleSubmitForm=n,r._inputList=Array.from(r._popUpElement.querySelectorAll(".modal-window__item")),r}return e=a,(n=[{key:"setEventListeners",value:function(){var t=this;N(G(a.prototype),"setEventListeners",this).call(this),this._popUpElement.addEventListener("submit",(function(){return t.handleSubmitForm(t._getInputValues())}))}},{key:"_getInputValues",value:function(){var t={};return this._inputList.forEach((function(e){null!=e.getAttribute("name")&&(t[e.getAttribute("name")]=e.value)})),t}},{key:"close",value:function(){this._inputList.forEach((function(t){t.value=""})),N(G(a.prototype),"close",this).call(this)}}])&&B(e.prototype,n),a}(q);function K(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var Q=function(){function t(e,n,o){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._userName=e,this._userAbout=n,this._userAvatar=o,this._setName=document.querySelector(this._userName),this._setAbout=document.querySelector(this._userAbout),this._setAvatar=document.querySelector(this._userAvatar),this._objUserInfo={user:document.querySelector(this._userName).textContent,about:document.querySelector(this._userAbout).textContent}}var e,n;return e=t,(n=[{key:"setUserInfo",value:function(t,e){t&&(this._setName.textContent=t),e&&(this._setAbout.textContent=e)}},{key:"setUserAvatar",value:function(t){this._setAvatar.src=t}},{key:"getUserInfo",value:function(){return{user:this._setName.textContent,about:this._setAbout.textContent}}}])&&K(e.prototype,n),t}();function W(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var X=function(){function t(e,n,o){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._token=e,this._addressCard=n,this._addressInfo=o}var e,n;return e=t,(n=[{key:"getProfileInfo",value:function(){var t=this;return fetch("".concat(this._addressInfo),{method:"GET",headers:{authorization:"".concat(this._token)}}).then((function(e){return t._getResponseData(e)}))}},{key:"patchProfileInfo",value:function(t,e){var n=this;return fetch("".concat(this._addressInfo),{method:"PATCH",headers:{authorization:"".concat(this._token),"Content-Type":"application/json"},body:JSON.stringify({name:"".concat(t),about:"".concat(e)})}).then((function(t){return n._getResponseData(t)}))}},{key:"patchProfileAvatar",value:function(t){var e=this;return fetch("".concat(this._addressInfo,"/avatar"),{method:"PATCH",headers:{authorization:"".concat(this._token),"Content-Type":"application/json"},body:JSON.stringify({avatar:"".concat(t)})}).then((function(t){return e._getResponseData(t)}))}},{key:"getCards",value:function(){var t=this;return fetch("".concat(this._addressCard),{method:"GET",headers:{authorization:"".concat(this._token)}}).then((function(e){return t._getResponseData(e)}))}},{key:"postCards",value:function(t,e){var n=this;return fetch("".concat(this._addressCard),{method:"POST",headers:{authorization:"".concat(this._token),"Content-Type":"application/json"},body:JSON.stringify({name:"".concat(t),link:"".concat(e)})}).then((function(t){return n._getResponseData(t)}))}},{key:"deleteCard",value:function(t){var e=this;return fetch("".concat(this._addressCard,"/").concat(t),{method:"DELETE",headers:{authorization:"".concat(this._token)}}).then((function(t){return e._getResponseData(t)}))}},{key:"putLike",value:function(t){var e=this;return fetch("".concat(this._addressCard,"/likes/").concat(t),{method:"PUT",headers:{authorization:"".concat(this._token)}}).then((function(t){return e._getResponseData(t)}))}},{key:"deleteLike",value:function(t){var e=this;return fetch("".concat(this._addressCard,"/likes/").concat(t),{method:"DELETE",headers:{authorization:"".concat(this._token)}}).then((function(t){return e._getResponseData(t)}))}},{key:"_getResponseData",value:function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}}])&&W(e.prototype,n),t}();new o(a,y).enableValidation(),new o(a,v).enableValidation(),new o(a,b).enableValidation();var Y=new M(l,".modal-window__submit-button",(function(t){f.textContent="Сохранить...",rt.patchProfileAvatar(t.link).then((function(){ot.setUserAvatar(t.link),f.setAttribute("disabled","disabled"),f.add("modal-window__submit-button_disabled"),Y.close()})).catch((function(t){console.log(t)})).finally((function(){f.textContent="Сохранить"}))}));Y.setEventListeners();var Z=new M(c,".modal-window__submit-button",(function(t){d.textContent="Сохранить...",rt.patchProfileInfo("".concat(t.name),"".concat(t.emloyment)).then((function(){ot.setUserInfo(t.name,t.emloyment),Z.close()})).catch((function(t){console.log(t)})).finally((function(){d.textContent="Сохранить"}))}));Z.setEventListeners();var $=new M(u,".modal-window__submit-button",(function(t){_.textContent="Сохранить...";var e=v.querySelector(".modal-window__submit-button"),n={name:t.place,link:t.link};m.value="",p.value="",rt.postCards("".concat(n.name),"".concat(n.link)).then((function(t){var n=it(t,t.owner.name,t.owner._id);nt.addItem(n,k),e.setAttribute("disabled","disabled"),e.classList.add("modal-window__submit-button_disabled"),$.close()})).catch((function(t){console.log(t)})).finally((function(){_.textContent="Сохранить"}))}));$.setEventListeners();var tt=new I(C);tt.setEventListeners();var et=new M(s);et.setEventListeners();var nt=new i({renderer:function(t,e,n){var o=it(t,e,n);nt.addItem(o,k)}},k),ot=new Q(".profile__title",".profile__subtitle",".profile__avatar"),rt=new X("99cf486b-e575-4fd7-a9fa-cafa2239ffe6","https://mesto.nomoreparties.co/v1/cohort-19/cards","https://mesto.nomoreparties.co/v1/cohort-19/users/me");function it(t,n,o){return new e(t,g,at,t.likes.length,st,ct,ut,o).returnCardElement(n)}function at(t){tt.open(t)}function ct(t,e,n){rt.putLike(t).then((function(){e.classList.add("element__button-like_active"),n.textContent=Number(n.textContent)+1})).catch((function(t){console.log(t)}))}function ut(t,e,n){rt.deleteLike(t).then((function(){e.classList.remove("element__button-like_active"),n.textContent=Number(n.textContent)-1})).catch((function(t){console.log(t)}))}function st(t){et.open(),L.addEventListener("click",(function(){lt(t)}))}Promise.all([rt.getCards(),rt.getProfileInfo()]).then((function(t){nt.addArray(t[0].reverse(),t[1].name,t[1]._id),ot.setUserInfo(t[1].name,t[1].about),ot.setUserAvatar(t[1].avatar)})).catch((function(t){console.log(t)}));var lt=function(t){L.textContent="Да...",rt.deleteCard(t).then((function(){document.getElementById(t).remove(),L.removeEventListener("click",lt),et.close()})).catch((function(t){console.log(t)})).finally((function(){L.textContent="Да"}))};w.addEventListener("click",(function(){return $.open()})),h.addEventListener("click",(function(){Z.open();var t=ot.getUserInfo();E.value=t.user,S.value=t.about})),O.addEventListener("click",(function(){Y.open()}))})();